<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Reversi Room</title>
</head>
<body>
  <h1>Reversi Room</h1>

  <!-- 共通エリア -->
  <div id="responseArea">Response: </div>
  <div id="tokenArea">Token: </div>

  <hr>

  <!-- Black (GET) -->
  <h2>Black (GET)</h2>
  <div>
    <button onclick="joinGet('black')">Join</button>
    <span>/1/join?seat=black</span>
  </div>
  <div>
    <label>X:</label>
    <select id="blackX"></select>
    <label>Y:</label>
    <select id="blackY"></select>
    <button onclick="moveGet()">Move</button>
    <span>/1/move?token=&lt;token&gt;&x=&lt;x&gt;&y=&lt;y&gt;</span>
  </div>
  <div>
    <button onclick="leaveGet()">Leave</button>
    <span>/1/leave?token=&lt;token&gt;</span>
  </div>

  <hr>

  <!-- White (POST) -->
  <h2>White (POST)</h2>
  <div>
    <button onclick="joinPost('white')">Join</button>
    <span>POST /1/join body: { seat:"white" }</span>
  </div>
  <div>
    <label>X:</label>
    <select id="whiteX"></select>
    <label>Y:</label>
    <select id="whiteY"></select>
    <button onclick="movePost()">Move</button>
    <span>POST /1/move body: { token:"&lt;token&gt;", x:&lt;x&gt;, y:&lt;y&gt; }</span>
  </div>
  <div>
    <button onclick="leavePost()">Leave</button>
    <span>POST /1/leave body: { token:"&lt;token&gt;" }</span>
  </div>

  <hr>

  <!-- Observer (POST) -->
  <h2>Observer (POST)</h2>
  <div>
    <button onclick="joinPost('observer')">Join</button>
    <span>POST /1/join body: { seat:"observer" }</span>
  </div>
  <div>
    <button onclick="leavePost()">Leave</button>
    <span>POST /1/leave body: { token:"&lt;token&gt;" }</span>
  </div>

  <hr>

  <!-- SSE -->
  <h2>SSE</h2>
  <div id="sseArea">SSE: </div>

  <script>
    const id = "1"; // ★ 今は固定で Room 1

    let token = null;

    function setResponse(res, status) {
      document.getElementById("responseArea").innerText =
        "Response: " + JSON.stringify(res) + " (status " + status + ")";
      if (res.token) {
        token = res.token;
        document.getElementById("tokenArea").innerText = "Token: " + token;
      }
    }

    // --- Black (GET) ---
    async function joinGet(seat) {
      const endpoint = `/${id}/join?seat=${seat}`;
      const res = await fetch(endpoint);
      const json = await res.json();
      setResponse(json, res.status);
    }

    async function moveGet() {
      const x = document.getElementById("blackX").value;
      const y = document.getElementById("blackY").value;
      const endpoint = `/${id}/move?token=${token}&x=${x}&y=${y}`;
      const res = await fetch(endpoint);
      const json = await res.json();
      setResponse(json, res.status);
    }

    async function leaveGet() {
      const endpoint = `/${id}/leave?token=${token}`;
      const res = await fetch(endpoint);
      const json = await res.json();
      setResponse(json, res.status);
    }

    // --- White / Observer (POST) ---
    async function joinPost(seat) {
      const endpoint = `/${id}/join`;
      const body = { seat };
      const res = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      const json = await res.json();
      setResponse(json, res.status);
    }

    async function movePost() {
      const x = document.getElementById("whiteX").value;
      const y = document.getElementById("whiteY").value;
      const endpoint = `/${id}/move`;
      const body = { token, x, y };
      const res = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      const json = await res.json();
      setResponse(json, res.status);
    }

    async function leavePost() {
      const endpoint = `/${id}/leave`;
      const body = { token };
      const res = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      const json = await res.json();
      setResponse(json, res.status);
    }

    // --- セレクトボックスに 1〜8 をセット ---
    function initSelect(id) {
      const el = document.getElementById(id);
      for (let i = 1; i <= 8; i++) {
        const opt = document.createElement("option");
        opt.value = i;
        opt.text = i;
        el.add(opt);
      }
    }
    initSelect("blackX"); initSelect("blackY");
    initSelect("whiteX"); initSelect("whiteY");

    // --- SSE 接続 ---
    const es = new EventSource(`/${id}/sse`);
    es.onmessage = (e) => {
      document.getElementById("sseArea").innerText =
        "SSE: " + e.data;
    };
  </script>
</body>
</html>